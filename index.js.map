{"version":3,"file":"index.js","sources":["src/helpers/index.js","src/templates/index.js","src/index.js"],"sourcesContent":["/**\n * \n * @param {string} heightString in the format `<ft>' <in>\"`\n * @returns \n */\nexport function parseHeightString(heightString) {\n    if (!heightString) return null;\n    // Regular expression to match patterns for feet and inches\n    const inchesRegex = /('|\\s)(\\d{1,3}\")/gm;\n    const feetRegex = /^(\\d{1,3}|\\d\\s|\\d\")/gm;\n\n    // Execute the regular expressions on the input height string\n    const inchesMatch = heightString.match(inchesRegex);\n    const feetMatch = heightString.match(feetRegex);\n\n    const feet = feetMatch[0];\n    const inches = inchesMatch[0].replace(/[\"\\s]/g, '');\n    // Return the height as a string in the format \"<feet>.<inches>\"\n    return feet + '.' + inches;\n}\n\n/**\n * Converts decimal feet to feet and inches. E.g. 6.5 feet, means \"six and a half feet\", which would be `6' 6\"`\n * @param {string} decimalFeet // 0.1, 1.3\n * @returns {string} feet and inches \n */\nexport function convertDecimalToHeightString(decimalFeet) {\n    // Split the decimal feet into integer and fractional parts\n    const integerFeet = Math.floor(decimalFeet);\n    const fractionalFeet = Math.round((decimalFeet - integerFeet) * 1e10) / 1e10;\n    // Convert the fractional part to inches (1 foot = 12 inches)\n    const inches = Math.floor(fractionalFeet * 12);\n    // Return the result as a string in the format \"feet' inches\"\"\n    return `${integerFeet}' ${inches}\"`;\n}\n\nexport function getLongJumpDistance(strength, type) {\n    const distance = (type == 'running' ? strength : strength / 2).toString();\n    return distance;\n}\n\n/**\n * This will check for active effects on the actor and process any that match this module\n * @param {Number} distance \n * @param {object} actor \n * @returns {Number}\n */\nfunction _processEffects(distance, actor) {\n    let modifiedDistance = distance;\n    if (!actor.effects.size) return distance;\n    let changes = [];\n    for (let effectRow of actor.effects) {\n        console.log(effectRow)\n        console.log(effectRow.changes)\n        console.log(effectRow.changes.length)\n        if (!effectRow.changes?.length || effectRow.isSuppressed || effectRow.disabled) continue\n        for (let change of effectRow.changes) {\n            console.log(change)\n            if (change.key === \"dnd5e.foundryvtt-dnd5e-jump-calculator\") {\n                changes.push(change);\n            }\n        }\n    }\n    changes.sort((a, b) => (a.priority || 0) - (b.priority || 0));\n\n    for (let change of changes) {\n        console.log(change)\n        console.log(change.mode)\n        switch (change.mode) {\n            case 1:\n                modifiedDistance = modifiedDistance * change.value;\n                break;\n            case 2:\n                modifiedDistance = modifiedDistance + change.value;\n                break;\n            case 3:\n                modifiedDistance = Math.min(modifiedDistance, change.value);\n                break;\n            case 4:\n                modifiedDistance = Math.max(modifiedDistance, change.value);\n                break;\n            case 5:\n                modifiedDistance = change.value;\n                break;\n            default:\n                modifiedDistance = modifiedDistance\n                break;\n        }\n    }\n    return modifiedDistance;\n}\n\nexport function calculateLongJump(strength, type, actor) {\n    const distance = _processEffects(getLongJumpDistance(strength, type), actor);\n    const heightString = convertDecimalToHeightString(distance);\n    return heightString;\n}\n\nexport function getHighJumpDistance(strMod, type) {\n    const distance = (type == 'running' ? 3 + Number(strMod) : (3 + Number(strMod)) / 2).toString();\n    return distance;\n}\n\nexport function calculateHighJump(strMod, type, actor) {\n    // 3 + your Strength modifier\n    const distance = _processEffects(getHighJumpDistance(strMod, type), actor);\n    return convertDecimalToHeightString(distance);\n}\n\n/**\n * @param {string} height <ft>.<in> \n * @returns <ft>.<in>*1.5\n */\nexport function calculateReach(height) {\n    // split height string by '.' character\n    const split = height.split('.');\n    const feet = Number(split[0]);\n    const inches = Number(split[1]);\n    const halfInches = inches / 2;\n    const halfFeet = feet / 2;\n    let reachFeet = feet + halfFeet;\n    let reachInches = inches + halfInches;\n    if (reachInches > 12) {\n        reachFeet += 1;\n        reachInches -= 12;\n    }\n    // const distance = String(reachFeet) + '.' + String(reachInches);\n    const decimalHeight = convertFeetAndInchesToDecimal(reachFeet, reachInches);\n    return convertDecimalToHeightString(decimalHeight);\n}\n\nexport function convertFeetAndInchesToDecimal(feet, inches) {\n    // Convert feet to inches and add to inches value\n    const totalInches = Number(feet) * 12 + Number(inches);\n    // Convert total inches to decimal feet\n    const decimalFeet = totalInches / 12;\n    const val = decimalFeet.toFixed(1); // Return as a string with one decimal place\n    return val;\n}\n","export const longJumpTextTemplate = `\n<div class=\"geoidesic-5e-jump-calc\">\n    <h2>{{5eJumpCalc.longJumpTitle}}</h2>\n    <p>PHB p182</p>\n    <p><strong>Running jump</strong> ({{5eJumpCalc.10FtFirst}}): <span class=\"lozenge\">{{running_jump}}</span></p>\n    <p><strong>Standing jump</strong>: <span class=\"lozenge\">{{standing_jump}}</span></p>\n    {{5eJumpCalc.longJumpPost}}\n</div>\n`;\n\n\nexport const highJumpTextTemplate = `\n<div class=\"geoidesic-5e-jump-calc\">\n    <h2>High Jump</h2>\n    <p>PHB p182</p>\n    <p><strong>Running jump</strong> ({{5eJumpCalc.10FtFirst}}): <span class=\"lozenge\">{{running_jump}}</span></p>\n    <p><strong>Standing jump</strong>: <span class=\"lozenge\">{{standing_jump}}</span></p>\n    <p><strong>Reach</strong>: <span class=\"lozenge\">+{{reach}}</span></p>\n    {{5eJumpCalc.highJumpPost}}\n</div>\n`;\n\nexport const sheetContent = `\n    <div class=\"pills-group\">\n        <h3 class=\"icon\">\n            <i class=\"fas fa-person-running\"></i>\n            <span class=\"roboto-upper\">Jump Calculator</span>\n        </h3>\n        <ul class=\"pills\">\n            <li class=\"pill geoidesic-5e-button\">\n                <span class=\"label\" id=\"renderHighJumpButton\">High jump</span>\n            </li>\n            <li class=\"pill geoidesic-5e-button\">\n                <span class=\"label\" id=\"renderLongJumpButton\">Long jump</span>\n            </li>\n        </ul>\n    </div>\n`;\n","import '../styles/init.scss'; // Import any styles as this includes them in the build.\nimport {parseHeightString, calculateLongJump, calculateHighJump, calculateReach } from '~/helpers'\nimport {longJumpTextTemplate, highJumpTextTemplate, sheetContent } from '~/templates'\n\nconst renderButtons = (app, html) => {\n\n    const strength = app.document.system.abilities.str.value || 10;\n    const strMod = app.document.system.abilities.str.mod || 0;\n    const height = parseHeightString(app.document.system.details.height);\n\n    // Add event listener to the button\n    const renderHighJumpButton = html.find('#renderHighJumpButton');\n    renderHighJumpButton.on('click', () => {\n        console.log('app', app)\n        // Render chat message\n        if(!height) {\n            ChatMessage.create({\n                content: \"<h2>High Jump</h2><p>This character's height has not been set. Please set the height in the Biography tab of the character sheet.</p>\"\n                ,\n                speaker: ChatMessage.getSpeaker({ actor: app.actor }),\n            });\n        } else {\n            ChatMessage.create({\n                content: highJumpTextTemplate\n                .replace(\"{{running_jump}}\", calculateHighJump(strMod, 'running', app.actor))\n                .replace(\"{{standing_jump}}\", calculateHighJump(strMod, 'standing', app.actor))\n                .replace(\"{{5eJumpCalc.highJumpTitle}}\", game.i18n.localize('5eJumpCalc.highJumpTitle'))\n                .replace(\"{{5eJumpCalc.highJumpPost}}\", game.i18n.localize('5eJumpCalc.highJumpPost'))\n                .replace(\"{{5eJumpCalc.10FtFirst}}\", game.i18n.localize('5eJumpCalc.10FtFirst'))\n                .replace(\"{{reach}}\", calculateReach(height))\n                +'<p>Check out <a href=\"https://foundryvtt.com/packages/foundryvtt-actor-studio\">Actor Studio</a> for more features!</p>'\n                ,\n                speaker: ChatMessage.getSpeaker({ actor: app.actor }),\n            });\n        }\n    });\n    const renderLongJumpButton = html.find('#renderLongJumpButton');\n    renderLongJumpButton.on('click', () => {\n        // Render chat message\n        ChatMessage.create({\n            content: longJumpTextTemplate\n            .replace(\"{{running_jump}}\", calculateLongJump(strength, 'running', app.actor))\n            .replace(\"{{standing_jump}}\", calculateLongJump(strength, 'standing', app.actor))\n            .replace(\"{{5eJumpCalc.longJumpTitle}}\", game.i18n.localize('5eJumpCalc.longJumpTitle'))\n            .replace(\"{{5eJumpCalc.longJumpPost}}\", game.i18n.localize('5eJumpCalc.longJumpPost'))\n            .replace(\"{{5eJumpCalc.10FtFirst}}\", game.i18n.localize('5eJumpCalc.10FtFirst'))\n            +'<p>Check out <a href=\"https://foundryvtt.com/packages/foundryvtt-actor-studio\">Actor Studio</a> for more features!</p>'\n            ,\n            speaker: ChatMessage.getSpeaker({ actor: app.actor }),\n        });\n    });\n}\n\nHooks.once(\"ready\", (app, html, data) => {\n    // CONFIG.debug.hooks = true;\n});\n\n  \nHooks.on(\"renderActorSheet5eCharacter\", (app, html, data) => {\n\n    if(game.modules.has(\"tidy5e-sheet\") && app.constructor.name === \"Tidy5eCharacterSheet\") {\n        const insertLocation = html.find('.main-panel .small-gap');\n        const templateHtml = $(sheetContent);\n        templateHtml.addClass('tidy5e');\n\n        // add styles\n        const pill = templateHtml.find('.pill');\n        pill.css('color', 'white');\n        pill.css('border-radius', '3px');\n        pill.css('width', '5rem');\n        pill.css('margin', '2px 0');\n        pill.css('padding', '2px 5px');\n        pill.css('cursor', 'pointer');\n        pill.css('background-color', 'var(--t5e-checkbox-outline-color)');\n        pill.css('border', '1px solid var(--dnd5e-color-tan)');\n\n        // insert to DOM\n        insertLocation.after(templateHtml);\n        renderButtons(app, html);\n    } else {\n        const insertLocation = html.find('.pills-group:last-of-type');\n        insertLocation.after(sheetContent);\n        renderButtons(app, html);\n    }\n});\n"],"names":["convertDecimalToHeightString","decimalFeet","integerFeet","Math","floor","fractionalFeet","round","_processEffects","distance","actor","modifiedDistance","effects","size","changes","effectRow","console","log","length","isSuppressed","disabled","change","key","push","sort","a","b","priority","mode","value","min","max","calculateLongJump","strength","type","toString","calculateHighJump","strMod","Number","calculateReach","height","split","feet","inches","reachFeet","reachInches","decimalHeight","totalInches","toFixed","longJumpTextTemplate","highJumpTextTemplate","sheetContent","renderButtons","app","html","document","system","abilities","str","mod","heightString","inchesMatch","match","replace","details","find","on","ChatMessage","create","content","game","i18n","localize","speaker","getSpeaker","Hooks","once","data","modules","has","constructor","name","insertLocation","templateHtml","$","addClass","pill","css","after"],"mappings":"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"}